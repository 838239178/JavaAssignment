# 《连连看》 Java课程设计方案 

@author 施嘉宏

### Swing界面组成

##### 需求分析

###### 1.核心界面

位于窗口中央，核心界面由n*n的方块组成，同种方块成对出现，并且是乱序的。每个方块一张图片，同类方块图片相同。方块间留足间隙满足观赏性。方块点击后应有方框标记。

###### 2.信息栏

位于窗口上方，提示栏包括游戏的标题和游戏的具体信息，包括游戏剩余时间(s)，时间进度条(%)和得分情况。

得分：根据时间、重置次数、消去方块得出。其中消去方块分最多为(n\*10)分，在此基础上除以(消耗时间\*重置次数*0.1)。

###### 3.菜单栏

位于窗口最上方横条，菜单栏应包含游戏暂停、游戏重开、游戏退出、方块再次打乱和“关于”界面的选项，应使用菜单和子菜单组合。游戏退出后显示欢迎界面。

###### 4.关于界面

新的窗口，由菜单栏启动，内容应包含该项目的基本信息，包括作者、时间、项目名称、源码地址等。

###### 5.欢迎界面

新的窗口，用于打开主程序，应包括游戏标题、开始按钮、关于按钮和退出按钮。开始按钮点击后应显示难度选择按钮。

###### 6.结算界面

##### 类的封装

###### EntryFrame

###### AboutDialog

###### GameClient

###### GamePanel

使用GridLayout填充Block对象。根据GameMap对象提供的数据绘制Block，方块相消判定成功后绘制连线。判定游戏是否结束，引出游戏结算界面。

###### MessagePanel

###### Block

###### BolckFactory

### 游戏逻辑构建

游戏逻辑主要在于方块数据、判断两个方块是否能消去以及游戏是否结束。

##### 需求分析

假设地图规模大小为**n*n**，方块种类为**i**种

###### 1.记录方块分布数据                                                

一个二维数组，不同的ID对应不同的方块，同一个ID应成对出现。空白方块使用特殊标记。

###### 2.操作方块分布数据

重新打乱二维数组中的数据，应注意只能打乱非空白方块的数据，空白的位置应保持不变。

判断两个方块是否能够相消，以何种方式相消。

传出和修改对应点的方块ID。

###### 3.生成方块分布数据

根据地图大小，创建一个二维数组，并在里面随机添加方块的ID。每种类型的方块添加**(n*n)/i**个，共**(n*n)/2i**组。根据**n**的不同，**i**需要改变为**n**的最大约数（且小于等于**i**的最大值）。

##### 核心算法

按照连连看规则——可连接的两个方块之间最多用三条直线相连——可以分类为三种判定方式。在判定过程中应注意边界问题。

判断流程如下：

<div align=left><img src="http://assets.processon.com/chart_image/5fb9fe8b6376895bf97aa12a.png" alt="判断顺序" style="zoom:85%;" />

###### 1.直接连通

即两个方块间可以用一条直线连接。处在同一行或者同一列且中间没有其他方块。

###### 2.单拐点连通

即两个方块间可以用两条线段连接。以两个方块为顶点得到一个矩形，矩形的另外两个顶点中任意一个所在的位置与这两个方块都可以直接连通，则可连接。

###### 3.双拐点连通

即两个方块间可以用三条线段连接。搜索其中一个方块周围四个方向空白的点，若任意一个点能与另一个方块单拐点连通，则能够连通。

###### 示意图

![示意图](https://i.loli.net/2020/11/22/mxpfO8b29MYSCET.png)

##### 类的封装

###### LinkType

枚举类型，表示四种方块的连通方式（包括一种无法连通）

###### GameMap

保存方块数据的类。负责判断连通，提供数据和信号给界面程序。构造时应指定地图大小。

接口：

- 判断是否连通的方法，返回连通类型。
- 地图数据的getter方法，返回方块ID。抛出数组越界异常。
- 清空指定两个点的方法。
- 判断并清空两个点的方法，返回布尔类型。
- 重新随机地图的方法。（利用MapFactory）

###### ~~MapFactory~~

~~单例工厂类，使用enum类型进行单例化。负责实现生成数据和打乱数据的功能。~~

### 界面交互逻辑

界面程序的逻辑除了画面切换以外，最重要的是使用GameMap的接口对游戏逻辑进行控制，包括使用GameMap判断方块是否可消去并且改变游戏画面，改变方块顺序以及接收GameMap的信号对游戏做出相应改变。

（写GamePanel和GameMap的联系）

##### 生成地图

##### 重绘地图

###### 1.顺序打乱

在gamemap中打乱后，检测二维数组的值，重新生成block。（暂定）

###### 2.连线特效
